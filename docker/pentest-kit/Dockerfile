FROM kalilinux/kali-rolling:latest

# Instalar herramientas generales y de pentesting
RUN apt update && apt upgrade -y && apt install -y \
    curl \
    git \
    nano \
    wget \
    zsh \
    unzip \
    fontconfig \
    locales \
    jq \
    nmap \
    net-tools \
    iputils-ping \
    arp-scan\
    sqlmap \
    subfinder \
    wpscan \
    whois \
    dirb \
    gobuster \
    wfuzz \
    metasploit-framework \
    seclists \
    smbclient \
    smbmap \
    python3 \
    python3-pip \
    python3-venv \
    golang \
    pipx \
    whatweb\
    hydra\
    command-not-found \
    && apt clean && rm -rf /var/lib/apt/lists/*

# Configurar locales
RUN sed -i 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /etc/locale.gen && locale-gen
ENV LANG=en_US.UTF-8
ENV LANGUAGE=en_US:en
ENV LC_ALL=en_US.UTF-8

# Descargar rockyou.txt
RUN wget https://github.com/brannondorsey/naive-hashcat/releases/download/data/rockyou.txt -O /usr/share/rockyou.txt

# Instalar Oh My Zsh sin interacción
RUN RUNZSH=no sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"

# Instalar Powerlevel10k
RUN git clone --depth=1 https://github.com/romkatv/powerlevel10k.git /root/powerlevel10k && \
    echo 'source ~/powerlevel10k/powerlevel10k.zsh-theme' >> /root/.zshrc

# Plugins de Zsh
RUN git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-/root/.oh-my-zsh/custom}/plugins/zsh-autosuggestions && \
    git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-/root/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting

# Configuración de plugins personalizados y Powerlevel10k
RUN curl -o /root/.p10k.zsh https://raw.githubusercontent.com/Santitub/pentest-kit/main/.p10k.zsh && \
    echo 'source ~/.p10k.zsh' >> /root/.zshrc && \
    sed -i 's/^plugins=(.*)/plugins=(git zsh-autosuggestions zsh-syntax-highlighting extract command-not-found)/' /root/.zshrc || \
    echo 'plugins=(git zsh-autosuggestions zsh-syntax-highlighting extract command-not-found)' >> /root/.zshrc && \
    echo 'POWERLEVEL9K_DISABLE_CONFIGURATION_WIZARD=true' >> /root/.zshrc

# Copiar el script y ejecutarlo
COPY install_tools.sh /tmp/install_tools.sh
RUN chmod +x /tmp/install_tools.sh && /tmp/install_tools.sh

# Usar Zsh como shell por defecto
SHELL ["/bin/zsh", "-c"]

CMD ["zsh"]
