#!/bin/bash
set -e

# Añadir ruta de pipx al PATH (sin duplicados)
grep -qxF 'export PATH=$PATH:/root/.local/bin' /root/.zshrc || echo 'export PATH=$PATH:/root/.local/bin' >> /root/.zshrc

# Añadir ruta de Go al PATH (sin duplicados)
grep -qxF 'export PATH=$PATH:/root/go/bin' /root/.zshrc || echo 'export PATH=$PATH:/root/go/bin' >> /root/.zshrc

# Instalar kerbrute en /usr/local/bin
GOBIN=/usr/local/bin go install github.com/ropnop/kerbrute@latest

# Instalar httpx y waybackurls en /usr/local/bin
GOBIN=/usr/local/bin go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest
GOBIN=/usr/local/bin go install github.com/tomnomnom/waybackurls@latest

# Instalar katana en /usr/local/bin
CGO_ENABLED=1 GOBIN=/usr/local/bin go install github.com/projectdiscovery/katana/cmd/katana@latest

# Instalar FiraCode Nerd Font
mkdir -p /usr/share/fonts/truetype/firacode
curl -sSL -o /tmp/FiraCode.zip https://github.com/ryanoasis/nerd-fonts/releases/latest/download/FiraCode.zip
unzip /tmp/FiraCode.zip -d /usr/share/fonts/truetype/firacode
rm /tmp/FiraCode.zip
fc-cache -fv

# Instalar herramientas Python con pipx sin error de PEP 668
pipx install git+https://github.com/Pennyw0rth/NetExec.git
pipx install impacket
pipx install wpat
pipx install sherlock-project

# Instalar Nikto con wrapper
git clone https://github.com/sullo/nikto.git /opt/nikto
echo '#!/bin/bash\nperl /opt/nikto/program/nikto.pl -config /opt/nikto/nikto.conf "$@"' > /usr/local/bin/nikto
chmod +x /usr/local/bin/nikto

#Instalar oralyzer
TMP_DIR="/tmp/oralyzer-install" && INSTALL_DIR="/usr/local/lib/oralyzer" && WRAPPER="/usr/local/bin/oralyzer" && REPO_URL="https://github.com/r0075h3ll/Oralyzer.git" && rm -rf "$TMP_DIR" "$INSTALL_DIR" "$WRAPPER" && git clone "$REPO_URL" "$TMP_DIR" && pip3 install --break-system-packages -r "$TMP_DIR/requirements.txt" && mkdir -p "$INSTALL_DIR" && mv "$TMP_DIR/oralyzer.py" "$INSTALL_DIR/" && mv "$TMP_DIR/core" "$INSTALL_DIR/" && mv "$TMP_DIR/payloads.txt" "$INSTALL_DIR/" 2>/dev/null || true && echo -e '#!/bin/bash\ncd "'"$INSTALL_DIR"'"\npython3 oralyzer.py "$@"' > "$WRAPPER" && chmod +x "$WRAPPER" && rm -rf "$TMP_DIR"
